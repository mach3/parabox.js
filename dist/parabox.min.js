/*!
 * ParaBox.js
 * ----------
 * @version 0.9.0
 * @author mach3 <http://github.com/mach3>
 * @license MIT License
 * @url http://github.com/mach3/parabox.js
 * @require jQuery
 */
!function(a){a.ParaBox={},a.ParaBox.background={defaults:{bgHeight:480,area:240,reverse:!0},initialize:function(b,c){var d=this;c=a.extend({},this.defaults,c),b.each(function(){var b,e;b=a(this),e={reverse:c.reverse,height:b.prop("clientHeight"),left:a.ParaBox.util.getLeft(b),offset:b.offset().top,area:c.area},e.margin=c.bgHeight-e.height,b.data("paraBoxAttrs",e),a(window).on("scroll",a.proxy(d.onScroll,b))})},onScroll:function(){var b,c,d;b=this.data("paraBoxAttrs"),c=a(window).scrollTop()-b.offset,d=Math.abs(c)<b.area?b.reverse?-1*(c+b.area)/(2*b.area)*b.margin+"px":-1*(1-(c+b.area)/(2*b.area))*b.margin+"px":b.reverse?0>c?"top":"bottom":0>c?"bottom":"top",this.css("background-position",[b.left,d].join(" "))}},a.ParaBox.item={defaults:{top:null,bottom:null,easing:"swing",duration:500,from:{},to:{}},initialize:function(b,c){var d=this;c=a.extend(!0,{},this.defaults,c),c.bottom||(c.bottom=a("body").height()),b.each(function(){var b,e;b=a(this),e={easing:c.easing,duration:c.duration,top:c.top,bottom:c.bottom,from:c.from,to:c.to},b.data("paraBoxAttrs",e),b.data("paraBoxShow",!1),b.css(e.from),a(window).on("scroll",a.proxy(d.onScroll,b))})},onScroll:function(){var b,c,d,e;b=a(window).scrollTop(),c=this.data("paraBoxAttrs"),d=this.data("paraBoxShow"),e=a.ParaBox.util.inRange(b,c.top,c.bottom),(d&&!e||!d&&e)&&(this.stop().animate(d?c.from:c.to,{easing:c.easing,duration:c.duration}),this.data("paraBoxShow",!d))}},a.ParaBox.section={node:null,points:null,index:null,initialize:function(b,c){var d=[];a.each(c,function(a,b){d.push({name:a,value:b})}),d.sort(function(a,b){return a.value-b.value}),this.points=d,this.node=b,a(window).on("scroll",a.proxy(this.onScroll,this))},onScroll:function(){var b,c,d,e;for(c=a(window).scrollTop(),b=this.points.length;b--&&!(this.points[b].value<c););b!==this.index&&(d=this.points[b],e={index:b,name:d?d.name:null,value:d?d.value:null,instance:this},this.node.trigger("sectionChange",e,this),this.index=b)}},a.ParaBox.util={inRange:function(a,b,c){return a>=b&&c>a},getLeft:function(a){return a.css("background-position-x")||a.css("background-position").split(" ")[0]}},a.fn.parabox=function(){var b,c,d;return b=a.makeArray(arguments),c=b.shift(),d=a.ParaBox[c],d&&(b.unshift(this),d.initialize.apply(d,b)),this}}(jQuery);